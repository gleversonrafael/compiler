import{currentUserBasicInformation as e}from"./jsuserdata.js";import{usersCol as t}from"./jsfirebase.js";import{getDocs as a,doc as n,updateDoc as r,query as l,where as o,limit as s}from"firebase/firestore";import{db as i}from"./jsfirebase.js";import c from"bcryptjs";function setReusableEvents(e){let t={formsEventCall:function e(){document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",e=>{e.preventDefault()})})},cancelModalEventCall:function e(){document.querySelectorAll(".cancelModalButton").forEach(e=>{e.addEventListener("click",e=>{let t=obtainFather(e.currentTarget,"modalJS").id;"noFather"===t&&(t="notAModal"),toggleModal(t)})})}};e.forEach(e=>{let a=t[`${e}Call`];a()})}function obtainFather(e,t){let a=e.parentElement,n;for(let r=0;r<6;r++)if(a.tagName.length>0&&!a.classList.contains(t))a=a.parentElement;else{n=!a.classList.contains(t);break}return!1===n?a:"noFather"}function showMessageBox(e,t){let a=document.querySelector(".messageBox"),n;function r(e){e.style.animation="100ms hideMessageBoxANIM linear",e.style.animationFillMode="forwards",setTimeout(()=>e.remove(),2500)}a&&a.remove(),a=function e(){let t=document.getElementById("mainHeader"),a=document.createElement("div");return a.classList.add("messageBox","bAll"),(n=document.createElement("button")).classList.add("closeMessageBox"),n.addEventListener("click",()=>r(a)),a.appendChild(n),t.appendChild(a),a}(),function r(){let l=document.createElement("p");l.innerText=t,a.classList.add(e),a.insertBefore(l,n)}(),setTimeout(()=>r(a),1e3)}function convertSpecificArrayIntoObject(e){let t={};for(let a=0;a<e.length;a++){let n=Object.entries(e[a])[0];Object.defineProperty(t,n[0],{value:n[1],configurable:!0,writable:!0,enumerable:!0})}return t}function forEachPropertyWithDo(e){let t=Object.entries(e.selectedObject);for(let a=0;a<t.length;a++){let n=t[a][0],r=t[a][1],l;if(e.comparisonType?"equal"===e.comparisonType&&(l=r===e.desiredValue):l=!!r,!0===l&&e.functionsArray){let o=e.functionsArray;for(let s=0;s<o.length;s++)o[s](n,r)}}}async function toggleModal(e){let t,a,n,r,l=document.getElementById("modalArea"),o=document.getElementById(e);"notAModal"!=e&&("flex"!=o.style.display?(a="flex",t=""):(a="none",t="200ms toggleItemANIM linear reverse",n=150),r=!0),!0===r?(o.style.animation=l.style.animation="none",requestAnimationFrame(()=>o.style.animation=l.style.animation=t),setTimeout(()=>{o.style.display=l.style.display=a},n)):console.log("an attempt to toggle something that isn't a modal by using a modal button occurred.")}async function customUpdateDocument(e){let t={result:!1,returnedData:null},a=n(i,e.selectedCollection,e.documentId);return await r(a,e.newData).then(a=>{e.desiredMessage&&showMessageBox("successMessage",e.desiredMessage),t.result=!0,t.returnedData=a}).catch(a=>{showMessageBox("errorMessage",e.errorMessage),console.log("ERROR:"+a.code),t.returnedData=a.code}),t}function obtainArrayFromInputs(e){let t=document.querySelectorAll("#"+e+" .fillableInputJS"),a=[];return t.forEach(e=>{a.push(e)}),a}function fillSelectedForm(e){let t=Object.entries(e.data);for(let a=0;a<t.length;a++){let n=t[a][0],r=t[a][1],l=document.querySelector(`#${e.selectedFormId} [data-relatedfield=${n}]`);l&&(l.value=r,l.placeholder=r)}}function convertHtmlStringToElement(e){let t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstElementChild}async function checkUserPassword(n){let r=await i();return c.compareSync(n,r);async function i(){let n;return await a(l(t,o("uid","==",e.uid),s(1))).then(e=>{e.forEach(e=>{let{password:t}=e.data();n=t})}),n}}function userDataIsValid(e){let t={name:/[\w]{2,}/,email:/[\w]{2,}@+[\w]{2,}.[\w]{2,}/,password:/.{4,12}/,telephone:/^$|[\d]{12,13}/,usertype:/regular|admin/},a=!0;for(let n=0;n<e.length;n++){let r=Object.entries(e[n])[0],l=t[r[0]];if(l&&!1===l.test(r[1])){console.log("validation-break"),a=!1;break}}return a}function obtainUserInputedData(e){let t=obtainArrayFromInputs(e),a=document.querySelector(`#${e} .userTypeInput:checked`);return a||(a=convertHtmlStringToElement('<input type="radio" name="usertype" value="null">')),t.push(a),t}function createUserDataArray(e,t,a){let n=[];return"create"===e&&n.push({active:!0},{deleted:!1}),t.forEach(t=>{if("create"===e||"edit"===e&&t.value!=a[t.name]){let r={};Object.defineProperty(r,t.name,{value:t.value,enumerable:!0,writable:!0}),n.push(r)}}),n}function generatePasswordHash(e){let t=c.genSaltSync(10),a=c.hashSync(e,t);return a}async function obtainDocumentDataFromField(e){let t=l(e.collectionVariable,o(e.fieldName,"==",e.fieldValue),s(1)),n;return await a(t).then(e=>{e.forEach(e=>{n=e.data()})}).catch(e=>{n="ERROR"}),n}function refreshAnimations(e,t){for(let a=0;a<e.length;a++){let n=e[a];n.style.animation="none",requestAnimationFrame(()=>{n.style.animation=t.length>1?t[a]:t[0]})}}export{setReusableEvents,convertHtmlStringToElement,obtainFather,fillSelectedForm,showMessageBox,userDataIsValid,checkUserPassword,obtainUserInputedData,generatePasswordHash,createUserDataArray,convertSpecificArrayIntoObject,forEachPropertyWithDo,obtainArrayFromInputs,toggleModal,refreshAnimations,customUpdateDocument,obtainDocumentDataFromField};