import{forEachPropertyWithDo as e,showMessageBox as t}from"./jsreusablestructures";import{currentUserBasicInformation as a}from"./jsuserdata.js";import{removeAdminElements as n}from"./jspermissions.js";import{changeSelectedBoxStyle as r}from"./jsmenu.js";function setPageChangeEvents(){let e=document.querySelectorAll('[data-changepagestate="possible"]');e.forEach(e=>{e.dataset.changepagestate="valid",e.addEventListener("click",async t=>{t.preventDefault(),await changePageFullProcess(e.name,e.dataset.selectedurl),r()})})}async function changePageFullProcess(e,t){await changePage(e,t),r()}async function changePage(t,r){let s=await getPageHtml(r);if(s){let l=document.querySelector("title"),c=`../html/main.html?currentpage=${t}`;l.innerText=function e(t){let a;switch(t){case"home":a="In\xedcio";break;case"mycourses":a="Meus cursos";break;case"managecourses-adb":a="Gerir cursos";break;case"manageusers-adb":a="Usu\xe1rios";break;case"myuser":a="Meu usu\xe1rio";break;default:a="P\xe1gina inexistente"}return a}(t),history.replaceState({},"",c),i("reset",s),i("create",s)}function i(t,r){let s=document.getElementById("mCon"),l=document.getElementById("modalArea");switch(t){case"create":(function e(){let t=Array.from(r.querySelectorAll("head link.dynamicallyGeneratedCSS[rel=stylesheet]")),a=document.head;t.forEach(e=>{a.appendChild(e)})})(),function e(){let t=Array.from(r.body.children);for(let s=0;s<t.length;s++){let l=t[s],c=l.id;if(c){let i=Array.from(l.children),o=document.getElementById(c);if(i)for(let u=0;u<i.length;u++){let d=i[u],m=d.querySelectorAll(".adminAcessJS");if(m.length>0&&"admin"!=a.usertype&&n(m),d.classList.contains("dynamicallyGeneratedScript")){let g=document.createElement("script");g.src=d.src,g.classList=d.classList,d=g}else"scriptsSection"===l.id&&(d=null);null!=d&&o.appendChild(d)}}}}();break;case"reset":s.innerHTML="",l&&(l.style.display="none",l.innerHTML=""),e({selectedObject:{generatedScripts:document.querySelectorAll("script.dynamicallyGeneratedScript"),generatedCSS:document.querySelectorAll("link.dynamicallyGeneratedCSS")},functionsArray:[deleteElements]})}}}async function getPageHtml(e){let n;return function t(){let n=a.usertype,r=!1;return(e.includes("adb")&&"admin"===n||!e.includes("adb"))&&(r=!0),r}()&&await fetch(e).then(e=>{if(e.ok)return e.text();t("errorMessage","N\xe3o foi poss\xedvel inicializar a p\xe1gina selecionada."),console.log("couldn't get the page.")}).then(e=>{let t=new DOMParser;n=t.parseFromString(e,"text/html")}),n}function preventUserFromAcessingTheHTMLFile(e){document.addEventListener("readystatechange",function t(){if(!window.location.search){let a=`main.html?currentpage=${e}`;window.location.replace(a)}}())}function deleteElements(e,t){let a=Array.from(t);for(let n=0;n<a.length;n++)a[n].remove()}export{setPageChangeEvents,changePage,preventUserFromAcessingTheHTMLFile};